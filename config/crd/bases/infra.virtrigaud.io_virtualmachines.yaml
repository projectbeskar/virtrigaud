---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: virtualmachines.infra.virtrigaud.io
spec:
  group: infra.virtrigaud.io
  names:
    kind: VirtualMachine
    listKind: VirtualMachineList
    plural: virtualmachines
    singular: virtualmachine
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .spec.providerRef.name
      name: Provider
      type: string
    - jsonPath: .spec.classRef.name
      name: Class
      type: string
    - jsonPath: .spec.imageRef.name
      name: Image
      type: string
    - jsonPath: .status.ips[*]
      name: IPs
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: VirtualMachine is the Schema for the virtualmachines API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: VirtualMachineSpec defines the desired state of VirtualMachine.
            properties:
              classRef:
                description: ClassRef references the VMClass that defines resource
                  allocation
                properties:
                  name:
                    description: Name of the referenced object
                    maxLength: 253
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                  namespace:
                    description: Namespace of the referenced object (defaults to current
                      namespace)
                    maxLength: 63
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                required:
                - name
                type: object
              disks:
                description: Disks specifies additional disks beyond the root disk
                items:
                  description: DiskSpec defines a disk configuration
                  properties:
                    expandPolicy:
                      default: Offline
                      description: ExpandPolicy defines how the disk can be expanded
                      enum:
                      - Online
                      - Offline
                      type: string
                    name:
                      description: Name is the disk identifier
                      maxLength: 63
                      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                      type: string
                    sizeGiB:
                      description: SizeGiB is the size of the disk in GiB
                      format: int32
                      maximum: 65536
                      minimum: 1
                      type: integer
                    storageClass:
                      description: StorageClass specifies the storage class (optional)
                      type: string
                    type:
                      default: thin
                      description: Type specifies the disk type (provider-specific)
                      enum:
                      - thin
                      - thick
                      - eagerzeroedthick
                      - ssd
                      - hdd
                      type: string
                  required:
                  - name
                  - sizeGiB
                  type: object
                maxItems: 20
                type: array
              imageRef:
                description: ImageRef references the VMImage to use as base template
                properties:
                  name:
                    description: Name of the referenced object
                    maxLength: 253
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                  namespace:
                    description: Namespace of the referenced object (defaults to current
                      namespace)
                    maxLength: 63
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                required:
                - name
                type: object
              lifecycle:
                description: Lifecycle defines VM lifecycle configuration
                properties:
                  gracefulShutdownTimeout:
                    default: 60s
                    description: GracefulShutdownTimeout defines how long to wait
                      for graceful shutdown
                    type: string
                  postStart:
                    description: PostStart defines actions to take after starting
                      the VM
                    properties:
                      exec:
                        description: Exec specifies a command to execute
                        properties:
                          command:
                            description: Command is the command line to execute
                            items:
                              type: string
                            minItems: 1
                            type: array
                        required:
                        - command
                        type: object
                      httpGet:
                        description: HTTPGet specifies an HTTP GET request
                        properties:
                          host:
                            description: Host name to connect to (defaults to VM IP)
                            type: string
                          path:
                            description: Path is the HTTP path to access
                            type: string
                          port:
                            description: Port is the port to access
                            format: int32
                            maximum: 65535
                            minimum: 1
                            type: integer
                          scheme:
                            default: HTTP
                            description: Scheme to use for connecting (HTTP or HTTPS)
                            enum:
                            - HTTP
                            - HTTPS
                            type: string
                        required:
                        - port
                        type: object
                      snapshot:
                        description: Snapshot specifies a snapshot to create
                        properties:
                          description:
                            description: Description provides context for the snapshot
                            type: string
                          includeMemory:
                            description: IncludeMemory indicates whether to include
                              memory state
                            type: boolean
                          name:
                            description: Name is the name hint for the snapshot
                            type: string
                        required:
                        - name
                        type: object
                    type: object
                  preStop:
                    description: PreStop defines actions to take before stopping the
                      VM
                    properties:
                      exec:
                        description: Exec specifies a command to execute
                        properties:
                          command:
                            description: Command is the command line to execute
                            items:
                              type: string
                            minItems: 1
                            type: array
                        required:
                        - command
                        type: object
                      httpGet:
                        description: HTTPGet specifies an HTTP GET request
                        properties:
                          host:
                            description: Host name to connect to (defaults to VM IP)
                            type: string
                          path:
                            description: Path is the HTTP path to access
                            type: string
                          port:
                            description: Port is the port to access
                            format: int32
                            maximum: 65535
                            minimum: 1
                            type: integer
                          scheme:
                            default: HTTP
                            description: Scheme to use for connecting (HTTP or HTTPS)
                            enum:
                            - HTTP
                            - HTTPS
                            type: string
                        required:
                        - port
                        type: object
                      snapshot:
                        description: Snapshot specifies a snapshot to create
                        properties:
                          description:
                            description: Description provides context for the snapshot
                            type: string
                          includeMemory:
                            description: IncludeMemory indicates whether to include
                              memory state
                            type: boolean
                          name:
                            description: Name is the name hint for the snapshot
                            type: string
                        required:
                        - name
                        type: object
                    type: object
                type: object
              networks:
                description: Networks specifies network attachments for the VM
                items:
                  description: VMNetworkRef represents a reference to a network attachment
                  properties:
                    ipAddress:
                      description: IPAddress specifies a static IP address (optional)
                      pattern: ^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$
                      type: string
                    macAddress:
                      description: MACAddress specifies a static MAC address (optional)
                      pattern: ^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$
                      type: string
                    name:
                      description: Name is the name of this network attachment
                      maxLength: 63
                      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                      type: string
                    networkRef:
                      description: NetworkRef references the VMNetworkAttachment
                      properties:
                        name:
                          description: Name of the referenced object
                          maxLength: 253
                          pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                          type: string
                        namespace:
                          description: Namespace of the referenced object (defaults
                            to current namespace)
                          maxLength: 63
                          pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                          type: string
                      required:
                      - name
                      type: object
                  required:
                  - name
                  - networkRef
                  type: object
                maxItems: 10
                type: array
              placement:
                description: Placement provides hints for VM placement
                properties:
                  cluster:
                    description: Cluster specifies the target cluster
                    type: string
                  datastore:
                    description: Datastore specifies the target datastore
                    type: string
                  folder:
                    description: Folder specifies the target folder
                    type: string
                  host:
                    description: Host specifies the target host
                    type: string
                  resourcePool:
                    description: ResourcePool specifies the target resource pool
                    type: string
                type: object
              placementRef:
                description: PlacementRef references a VMPlacementPolicy for advanced
                  placement rules
                properties:
                  name:
                    description: Name of the referenced object
                    maxLength: 253
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                required:
                - name
                type: object
              powerState:
                allOf:
                - enum:
                  - "On"
                  - "Off"
                - enum:
                  - "On"
                  - "Off"
                description: PowerState specifies the desired power state
                type: string
              providerRef:
                description: ProviderRef references the Provider that manages this
                  VM
                properties:
                  name:
                    description: Name of the referenced object
                    maxLength: 253
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                  namespace:
                    description: Namespace of the referenced object (defaults to current
                      namespace)
                    maxLength: 63
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                required:
                - name
                type: object
              resources:
                description: Resources allows overriding resource allocation from
                  the VMClass
                properties:
                  cpu:
                    description: CPU specifies the number of virtual CPUs
                    format: int32
                    maximum: 128
                    minimum: 1
                    type: integer
                  gpu:
                    description: GPU specifies GPU configuration
                    properties:
                      count:
                        description: Count specifies the number of GPUs to assign
                        format: int32
                        maximum: 8
                        minimum: 1
                        type: integer
                      memory:
                        description: Memory specifies GPU memory in MiB
                        format: int64
                        minimum: 512
                        type: integer
                      type:
                        description: Type specifies the GPU type (provider-specific)
                        pattern: ^[a-zA-Z0-9-_]+$
                        type: string
                    required:
                    - count
                    type: object
                  memoryMiB:
                    description: MemoryMiB specifies the amount of memory in MiB
                    format: int64
                    maximum: 1048576
                    minimum: 128
                    type: integer
                type: object
              snapshot:
                description: Snapshot defines snapshot-related operations
                properties:
                  revertToRef:
                    description: RevertToRef specifies a snapshot to revert to
                    properties:
                      name:
                        description: Name of the referenced object
                        maxLength: 253
                        pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                        type: string
                    required:
                    - name
                    type: object
                type: object
              tags:
                description: Tags are applied to the VM for organization
                items:
                  type: string
                maxItems: 50
                type: array
              userData:
                description: UserData contains cloud-init configuration
                properties:
                  cloudInit:
                    description: CloudInit contains cloud-init configuration
                    properties:
                      inline:
                        description: Inline contains inline cloud-init data
                        type: string
                      secretRef:
                        description: SecretRef references a Secret containing cloud-init
                          data
                        properties:
                          name:
                            description: Name of the referenced object
                            maxLength: 253
                            pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                            type: string
                        required:
                        - name
                        type: object
                    type: object
                  ignition:
                    description: Ignition contains Ignition configuration for CoreOS/RHEL
                    properties:
                      inline:
                        description: Inline contains inline Ignition data
                        type: string
                      secretRef:
                        description: SecretRef references a Secret containing Ignition
                          data
                        properties:
                          name:
                            description: Name of the referenced object
                            maxLength: 253
                            pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                            type: string
                        required:
                        - name
                        type: object
                    type: object
                type: object
            required:
            - classRef
            - imageRef
            - providerRef
            type: object
          status:
            description: VirtualMachineStatus defines the observed state of VirtualMachine.
            properties:
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              consoleURL:
                description: ConsoleURL provides access to the VM console
                type: string
              currentResources:
                description: CurrentResources shows the current resource allocation
                properties:
                  cpu:
                    description: CPU specifies the number of virtual CPUs
                    format: int32
                    maximum: 128
                    minimum: 1
                    type: integer
                  gpu:
                    description: GPU specifies GPU configuration
                    properties:
                      count:
                        description: Count specifies the number of GPUs to assign
                        format: int32
                        maximum: 8
                        minimum: 1
                        type: integer
                      memory:
                        description: Memory specifies GPU memory in MiB
                        format: int64
                        minimum: 512
                        type: integer
                      type:
                        description: Type specifies the GPU type (provider-specific)
                        pattern: ^[a-zA-Z0-9-_]+$
                        type: string
                    required:
                    - count
                    type: object
                  memoryMiB:
                    description: MemoryMiB specifies the amount of memory in MiB
                    format: int64
                    maximum: 1048576
                    minimum: 128
                    type: integer
                type: object
              id:
                description: ID is the provider-specific identifier for this VM
                type: string
              ips:
                description: IPs contains the IP addresses assigned to the VM
                items:
                  type: string
                type: array
              lastReconfigureTime:
                description: LastReconfigureTime records when the last reconfiguration
                  occurred
                format: date-time
                type: string
              lastTaskRef:
                description: LastTaskRef references the last async operation
                type: string
              message:
                description: Message provides additional details about the current
                  state
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation observed by
                  the controller
                format: int64
                type: integer
              phase:
                description: Phase represents the current phase of the VM
                enum:
                - Pending
                - Provisioning
                - Running
                - Stopped
                - Reconfiguring
                - Deleting
                - Failed
                type: string
              powerState:
                description: PowerState reflects the current power state
                enum:
                - "On"
                - "Off"
                type: string
              provider:
                additionalProperties:
                  type: string
                description: Provider contains provider-specific details
                type: object
                x-kubernetes-preserve-unknown-fields: true
              reconfigureTaskRef:
                description: ReconfigureTaskRef tracks reconfiguration operations
                type: string
              snapshots:
                description: Snapshots lists available snapshots for this VM
                items:
                  description: VMSnapshotInfo provides information about a VM snapshot
                  properties:
                    creationTime:
                      description: CreationTime is when the snapshot was created
                      format: date-time
                      type: string
                    description:
                      description: Description provides additional context
                      type: string
                    hasMemory:
                      description: HasMemory indicates if memory state is included
                      type: boolean
                    id:
                      description: ID is the provider-specific snapshot identifier
                      type: string
                    name:
                      description: Name is the snapshot name
                      type: string
                    sizeBytes:
                      description: SizeBytes is the size of the snapshot
                      format: int64
                      type: integer
                  required:
                  - creationTime
                  - id
                  - name
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      scale:
        specReplicasPath: .spec.replicas
        statusReplicasPath: .status.replicas
      status: {}
