# VirtRigaud v0.2.3 - Provider Feature Parity Release

This release brings all three providers (vSphere, Libvirt, and Proxmox) to feature parity with comprehensive VM reconfiguration, cloning, console access, and enhanced observability capabilities.

## Highlights

- **vSphere Provider**: Complete reconfiguration, async task tracking, cloning, and console URL generation
- **Libvirt Provider**: Full reconfiguration support and VNC console access
- **Proxmox Provider**: Guest agent IP detection, template cloning, and production-ready features
- **Documentation**: Comprehensive updates with advanced examples for v0.2.3 features

## Added

### vSphere Provider

**VM Reconfiguration Support**
- Online CPU adjustment for running VMs (hot-add when supported by guest OS)
- Online memory adjustment for running VMs (hot-add when supported)
- Disk resizing with safety checks to prevent data loss (shrinking prevented)
- Intelligent change detection to avoid unnecessary reconfigurations
- Memory parsing support for multiple units (Mi, Gi, MiB, GiB)
- Automatic fallback to offline changes when online modification is not supported

**Asynchronous Task Tracking**
- Real-time monitoring of vSphere async operations via govmomi
- Task state reporting (queued, running, success, error)
- Error information extraction from failed tasks
- Progress tracking with percentage completion
- Integration with vSphere task manager for reliable operation status

**VM Cloning Operations**
- Full clone support for independent VM copies
- Linked clone support for space-efficient template-based deployments
- Automatic snapshot creation for linked clones when no snapshot exists
- Proper disk relocation and storage configuration
- Clone naming and folder placement control

**Console URL Generation**
- Automatic vSphere web client console URL generation
- Direct browser-based VM console access via vCenter
- URL includes VM instance UUID for reliable identification
- Integration with vCenter endpoint for proper routing

### Libvirt Provider

**VM Reconfiguration Support**
- Online CPU adjustment via `virsh setvcpus --live` for running VMs
- Online memory adjustment via `virsh setmem --live` for running VMs
- Offline configuration updates for stopped VMs via `virsh setvcpus/setmem --config`
- Disk volume resizing via storage provider integration
- Automatic VM info parsing to extract current CPU and memory settings
- Graceful handling of operations requiring VM restart
- Memory unit conversion and validation (bytes, KiB, MiB, GiB)

**VNC Console URL Generation**
- Automatic VNC port extraction from domain XML configuration
- VNC console URL generation for direct viewer connections
- Support for standard VNC clients and web-based VNC viewers
- Integration with libvirt graphics configuration

### Proxmox Provider

**Guest Agent IP Detection**
- QEMU guest agent integration for accurate IP address detection
- Extraction of all network interfaces from running VMs
- Automatic filtering of loopback and link-local addresses
- Support for both IPv4 and IPv6 address reporting
- Real-time IP information when guest agent is installed and running

**Template Cloning Support**
- Automatic template detection from VMImage CRD `templateID` or `templateName`
- Full clone and linked clone support via `fullClone` parameter
- Proper storage pool selection during clone operation
- Clone task monitoring with async operation support

**Intelligent Boot Order Configuration**
- Auto-detection of primary boot disk from cloned template
- Support for multiple disk types: scsi, virtio, sata, ide
- Automatic boot order generation (e.g., `boot=order=scsi0;ide2`)
- Exclusion of CD-ROM devices from boot order

**Cloud-Init Integration**
- Complete cloud-init configuration via `ide2:cloudinit` device
- SSH key injection with proper URL encoding
- User creation and authentication setup
- Network configuration (static IP and DHCP)
- Package installation and custom commands via runcmd

**Complete CRD Support**
- ProxmoxImageSource integration for template-based deployments
- ProxmoxNetworkConfig for bridge and VLAN configuration
- Controller parsing of Proxmox-specific fields
- Provider RPC implementation for all VM operations

**Production Features**
- VM creation, power management, deletion
- Status reporting with IP address detection
- Task-based async operations with progress tracking
- Comprehensive error handling and logging

### Documentation

**Updated Documentation**
- Comprehensive provider documentation updates for v0.2.3 features
- Updated provider capabilities matrix with reconfiguration, task tracking, and console features
- Enhanced getting started guides with v0.2.3 examples
- Updated image versions across all documentation (v0.2.0 -> v0.2.3)

**Advanced Examples**
- vSphere clone examples (full and linked clones)
- vSphere task tracking examples for async operations
- Console access examples (vSphere web console and Libvirt VNC)
- Comprehensive usage patterns and troubleshooting guides

## Fixed

### vSphere Provider

**Reconfigure Type Mismatch**
- Fixed memory comparison causing compilation error due to int64/int32 type mismatch
- Added explicit type casting for `vmMo.Config.Hardware.MemoryMB` comparison
- Removed unnecessary type conversions flagged by linter

### Libvirt Provider

**Missing Standard Library Imports**
- Added missing `strconv` import for integer conversion in CPU/memory parsing
- Added missing `net/url` import for VNC console URL construction
- Fixed compilation failures in Reconfigure and Describe functions

### Proxmox Provider

**SSH Keys Encoding**
- Fixed SSH key double URL encoding for Proxmox API compatibility
- Proper handling of spaces and special characters in SSH keys

**Template Cloning and Boot Order**
- Implemented proper template detection and cloning workflow
- Added intelligent disk detection for boot order configuration
- Fixed VM creation to use template cloning instead of from-scratch creation

**Controller Image Source Parsing**
- Fixed JSON field name mapping for `TemplateName` vs `template_name`
- Added comprehensive debug logging for data flow tracing
- Corrected template ID transmission from VMImage CRD to provider

### CI/CD

**Helm Chart CRD Synchronization**
- Fixed out-of-sync Helm CRDs for Proxmox provider types
- Added missing ProxmoxImageSource and ProxmoxNetworkConfig fields
- Generated missing DeepCopy methods for Proxmox types

**Release Workflow**
- Fixed Helm chart image tag updates during releases
- Replaced fragile regex patterns with precise line-number-based patterns
- Ensured all component images update correctly to match release version

**Test Fixes**
- Fixed Proxmox fake server clone API parameter (`newid` vs `vmid`)
- Corrected test failures in TestProxmoxProvider_Clone

## Provider Status

- **vSphere**: Production Ready - Full feature set with enterprise capabilities
- **Libvirt**: Production Ready - Complete KVM/QEMU support
- **Proxmox**: Production Ready (Beta) - Full template-based deployment support

## Deployment

### Container Images

All provider images are available from GitHub Container Registry:

- Manager: `ghcr.io/projectbeskar/virtrigaud/manager:v0.2.3`
- vSphere Provider: `ghcr.io/projectbeskar/virtrigaud/provider-vsphere:v0.2.3`
- Libvirt Provider: `ghcr.io/projectbeskar/virtrigaud/provider-libvirt:v0.2.3`
- Proxmox Provider: `ghcr.io/projectbeskar/virtrigaud/provider-proxmox:v0.2.3`

### Helm Installation

```bash
helm repo add virtrigaud https://projectbeskar.github.io/virtrigaud
helm repo update
helm install virtrigaud virtrigaud/virtrigaud --version 0.2.3 -n virtrigaud-system --create-namespace
```

### Upgrade from v0.2.2

```bash
helm upgrade virtrigaud virtrigaud/virtrigaud --version 0.2.3 -n virtrigaud-system
```

## Breaking Changes

None. This release maintains full backward compatibility with v0.2.2.

## What's Next

**Roadmap for v0.3.0**:
- Enhanced multi-provider features and cross-provider operations
- Advanced networking with service mesh integration
- Improved backup and disaster recovery capabilities
- Additional provider implementations (cloud providers)

## Contributors

This release includes contributions from the VirtRigaud development team. Special thanks to all contributors who helped achieve provider feature parity.

## Documentation

- [Provider Documentation](https://github.com/projectbeskar/virtrigaud/tree/v0.2.3/docs/providers)
- [Provider Capabilities Matrix](https://github.com/projectbeskar/virtrigaud/blob/v0.2.3/docs/PROVIDERS_CAPABILITIES.md)
- [Getting Started Guide](https://github.com/projectbeskar/virtrigaud/blob/v0.2.3/docs/getting-started/quickstart.md)
- [Advanced Examples](https://github.com/projectbeskar/virtrigaud/tree/v0.2.3/docs/examples/advanced)

**Full Changelog**: https://github.com/projectbeskar/virtrigaud/compare/v0.2.2...v0.2.3

